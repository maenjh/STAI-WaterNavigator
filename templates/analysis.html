<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Points Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <style>
        .leaflet-container {
            background-color: #f0f9ff;
        }
        .blinking-animation{
            animation:blinking 1.5s ease-in-out infinite alternate
        }
        @keyframes blinking{
            0%{ opacity:1 }
            100%{ opacity:0.2 }
        }
        .typing-cursor {
            display: inline-block;
            width: 8px;
            height: 1.2rem;
            background-color: #333;
            animation: blink 0.7s infinite;
        }
    </style>
</head>
<body class="bg-[#f0f9ff]">
    <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#dbeafe] px-10 py-4 shadow-sm bg-white">
        <a href="/" class="flex items-center gap-3 text-[#1e3a8a]">
            <span class="material-icons text-3xl text-[#2563eb]">water_drop</span>
            <h2 class="text-[#1e3a8a] text-2xl font-bold leading-tight tracking-tight">Water Navigator</h2>
        </a>
        <div class="flex flex-1 justify-end gap-6">
            <nav class="flex items-center gap-6">
                <a class="text-[#334155] hover:text-[#2563eb] text-base font-medium leading-normal transition-colors" href="/#about">About</a>
                <a class="text-[#334155] hover:text-[#2563eb] text-base font-medium leading-normal transition-colors" href="/#features">Core Features</a>
                <a class="text-[#334155] hover:text-[#2563eb] text-base font-medium leading-normal transition-colors" href="/#use-cases">Use Cases</a>
                <a class="text-[#334155] hover:text-[#2563eb] text-base font-medium leading-normal transition-colors" href="/#contact">Contact</a>
            </nav>
            <button class="flex min-w-[100px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-11 px-6 bg-[#2563eb] text-[#f0f9ff] text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#1d4ed8] transition-colors shadow-md hover:shadow-lg">
                <span class="truncate">Request a Demo</span>
            </button>
        </div>
    </header>
    <div class="min-h-screen flex flex-col p-4">
        <main class="w-full max-w-screen-2xl mx-auto flex flex-col lg:flex-row gap-8 flex-1">

            <!-- Left Panel (Map) -->
            <div class="flex-1 flex flex-col gap-4">
                <div id="map" class="flex-1 rounded-xl shadow-lg">
                    <!-- Map is rendered here -->
                </div>
            </div>

            <!-- Right Panel (Controls) -->
            <aside class="w-full lg:w-[420px] bg-white rounded-2xl shadow-xl p-6 flex flex-col gap-6 overflow-y-auto">

                <!-- Filters -->
                <div>
                    <h2 class="text-xl font-bold mb-4 text-[#1e3a8a]">Filters</h2>
                    <form>
                        <div class="mb-4">
                            <label for="country-select" class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                            <select id="country-select" class="w-full border-gray-300 rounded-md shadow-sm">
                                <option>Ethiopia</option>
                                <option>Angola</option>
                                <option>Bangladesh</option>
                                <option>Cambodia</option>
                                <option>Haiti</option>
                                <option>Laos</option>
                                <option>Madagascar</option>
                                <option>Myanmar</option>
                                <option>Nepal</option>
                                <option>Senegal</option>
                                <option>Somalia</option>
                                <option>Tanzania</option>
                                <option>Uganda</option>
                                <option>Yemen</option>
                            </select>
                        </div>
                        <div>
                            <label for="region-select" class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                            <select id="region-select" disabled class="w-full border-gray-300 rounded-md shadow-sm bg-gray-100">
                                <option>Loading regions...</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- Core Analysis -->
                <div>
                    <h2 class="text-xl font-bold mb-2 text-[#1e3a8a]">핵심 분석</h2>
                    <div id="core-analysis-controls" class="bg-gray-50 p-4 rounded-lg">
                        <p class="text-sm font-bold mb-2">분석 실행</p>
                        <button id="start-analysis-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition w-full">
                            분석 실행
                        </button>
                    </div>
                    <div id="analysis-processing-indicator" class="hidden mt-2">
                        <p class="text-gray-600 animate-pulse">processing...</p>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div id="analysis-results-wrapper" class="hidden">
                    <h2 class="text-xl font-bold mb-2 text-[#1e3a8a]">분석 결과</h2>
                    <div id="analysis-results">
                        <h3 class="text-lg font-semibold">후보 지역</h3>
                        <p class="text-gray-600">총 <span id="candidate-sites-count" class="font-bold">0</span>개의 후보지를 찾았습니다.</p>
                        <div id="candidate-sites-list" class="mt-2 max-h-48 overflow-y-auto"></div>
                        
                        <!-- Generate Report Button -->
                        <div class="mt-4">
                            <button id="generate-report-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition w-full opacity-50 cursor-not-allowed" disabled>
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Legend -->
                <div class="mt-auto">
                    <h2 class="text-xl font-bold mb-2 text-[#1e3a8a]">Legend</h2>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="material-icons text-blue-500">place</span>
                                <span>Existing Water Point</span>
                            </div>
                            <span id="existing-water-points-count" class="font-bold">0</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="material-icons text-red-500">place</span>
                                <span>추천 후보지</span>
                            </div>
                            <span id="candidate-sites-count-legend" class="font-bold">0</span>
                        </div>
                    </div>
                </div>

            </aside>
        </main>

        <!-- Report Section -->
        <section id="report-container" class="hidden w-full max-w-screen-2xl mx-auto mt-8 p-4">
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Generated Report</h2>
                <div id="report-content" class="prose max-w-none text-gray-700"></div>
            </div>
        </section>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const map = L.map('map').setView([9.145, 40.4897], 6);
        
        map.whenReady(() => {
            setTimeout(() => map.invalidateSize(), 100);
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const countryCoordinates = {
            "Ethiopia": { lat: 9.145, lon: 40.4897, zoom: 6 },
            "Angola": { lat: -11.2027, lon: 17.8739, zoom: 5 },
            "Bangladesh": { lat: 23.6850, lon: 90.3563, zoom: 7 },
            "Cambodia": { lat: 12.5657, lon: 104.9910, zoom: 7 },
            "Haiti": { lat: 18.9712, lon: -72.2852, zoom: 8 },
            "Laos": { lat: 19.8563, lon: 102.4955, zoom: 6 },
            "Madagascar": { lat: -18.7669, lon: 46.8691, zoom: 5 },
            "Myanmar": { lat: 21.9162, lon: 95.9560, zoom: 5 },
            "Nepal": { lat: 28.3949, lon: 84.1240, zoom: 7 },
            "Senegal": { lat: 14.4974, lon: -14.4524, zoom: 7 },
            "Somalia": { lat: 5.1521, lon: 46.1996, zoom: 6 },
            "Tanzania": { lat: -6.3690, lon: 34.8888, zoom: 6 },
            "Uganda": { lat: 1.3733, lon: 32.2903, zoom: 7 },
            "Yemen": { lat: 15.5527, lon: 48.5164, zoom: 6 }
        };

        let ethiopiaRegions = {
            "Addis Abeba": { lat: 9.0, lon: 38.75 },
            "Afar": { lat: 11.71, lon: 41.03 },
            "Amhara": { lat: 11.59, lon: 37.95 },
            "Benishangul-Gumuz": { lat: 10.77, lon: 35.61 },
            "Dire Dawa": { lat: 9.6, lon: 41.85 },
            "Gambela": { lat: 7.91, lon: 34.66 },
            "Harari": { lat: 9.31, lon: 42.12 },
            "Oromia": { lat: 7.55, lon: 40.63 },
            "SNNP": { lat: 6.35, lon: 36.67 },
            "Somali": { lat: 7.22, lon: 43.79 },
            "Tigray": { lat: 13.88, lon: 39.13 }
        };
        
        let regionGeojsonData = null;
        let regionBoundaryLayer = null;
        let candidateRegionHighlightLayer = null;
        let allWaterPointsData = [];
        let waterPointsLayerGroup = L.markerClusterGroup();
        let candidateSiteLayerGroup = L.layerGroup();

        const waterPointIcon = L.divIcon({
            html: `<span class="material-icons text-blue-500" style="font-size: 24px;">place</span>`,
            className: 'custom-div-icon',
            iconSize: [24, 24],
            iconAnchor: [12, 24]
        });

        function createNumberedIcon(number) {
            return L.divIcon({
                html: `
                    <div class="relative flex items-center justify-center">
                        <span class="material-icons text-red-500" style="font-size: 36px;">place</span>
                        <span class="absolute text-white text-xs font-bold" style="top: 8px;">${number}</span>
                    </div>
                `,
                className: 'custom-numbered-icon',
                iconSize: [36, 36],
                iconAnchor: [18, 36]
            });
        }
        
        function loadData() {
            Promise.all([
                fetch('/api/waterpoints').then(res => res.json()),
                fetch('/static/ethiopia_regions.json').then(res => res.json())
            ]).then(([waterPoints, regions]) => {
                
                regionGeojsonData = regions;
                
                const regionFeatures = regions.features;
                const pointsInEthiopia = waterPoints.filter(point => {
                    if (!point.lat || !point.lon) return false;
                    const turfPoint = turf.point([point.lon, point.lat]);
                    for (const feature of regionFeatures) {
                        if (turf.booleanPointInPolygon(turfPoint, feature)) {
                            return true;
                        }
                    }
                    return false;
                });
                
                allWaterPointsData = pointsInEthiopia; 

                document.getElementById('existing-water-points-count').textContent = pointsInEthiopia.length.toLocaleString();
                waterPointsLayerGroup.clearLayers();
                const markers = pointsInEthiopia.map(point => {
                    return L.marker([point.lat, point.lon], {
                        icon: waterPointIcon
                    }).bindPopup(`Water Point: ${parseFloat(point.lat).toFixed(4)}, ${parseFloat(point.lon).toFixed(4)}`);
                });
                waterPointsLayerGroup.addLayers(markers);

            }).catch(error => {
                console.error('Error loading map data:', error);
            });
        }
        
        loadData();

        map.addLayer(waterPointsLayerGroup);
        map.addLayer(candidateSiteLayerGroup);
       
        const regionSelect = document.getElementById('region-select');
        
        fetch('/static/ethiopia_regions.json')
            .then(response => response.json())
            .then(data => {
                const regionNames = data.features.map(feature => feature.properties.NAME_1).sort();
                regionSelect.innerHTML = '<option value="">전체 보기</option>';
                regionNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    regionSelect.appendChild(option);
                });
                regionSelect.disabled = false;
            })
            .catch(error => {
                console.error('Error loading region data:', error);
                regionSelect.disabled = true;
            });

        const countrySelect = document.getElementById('country-select');
        countrySelect.addEventListener('change', (event) => {
            const countryName = event.target.value;
            if (countryCoordinates[countryName]) {
                const { lat, lon, zoom } = countryCoordinates[countryName];
                map.flyTo([lat, lon], zoom);

                // For now, region and analysis are specific to Ethiopia
                const isEthiopia = countryName === 'Ethiopia';
                document.getElementById('region-select').disabled = !isEthiopia;
                document.getElementById('core-analysis-controls').style.display = isEthiopia ? 'block' : 'none';
                
                // Clear Ethiopia-specific layers if another country is selected
                if (!isEthiopia) {
                    waterPointsLayerGroup.clearLayers();
                    candidateSiteLayerGroup.clearLayers();
                    document.getElementById('analysis-results-wrapper').style.display = 'none';
                    if (regionBoundaryLayer) {
                        map.removeLayer(regionBoundaryLayer);
                    }
                    if (candidateRegionHighlightLayer) {
                        map.removeLayer(candidateRegionHighlightLayer);
                    }
                } else {
                    // Reload Ethiopia data if selected back
                    loadData();
                }
            }
        });

        regionSelect.addEventListener('change', (event) => {
            const regionName = event.target.value;
            
            if (regionBoundaryLayer) {
                map.removeLayer(regionBoundaryLayer);
            }

            if (!regionName || regionName === "") {
                map.setView([9.145, 40.4897], 6);
                return;
            }

            if (regionGeojsonData) {
                const regionFeature = regionGeojsonData.features.find(
                    feature => feature.properties.NAME_1 === regionName
                );

                if (regionFeature) {
                    regionBoundaryLayer = L.geoJSON(regionFeature, {
                        style: {
                            color: "#3b82f6",
                            weight: 2,
                            opacity: 1,
                            fillColor: "#bfdbfe",
                            fillOpacity: 0.4
                        }
                    }).addTo(map);
                    map.fitBounds(regionBoundaryLayer.getBounds());
                } else {
                    if (ethiopiaRegions[regionName]) {
                        const { lat, lon } = ethiopiaRegions[regionName];
                        map.setView([lat, lon], 9);
                    }
                }
            }
        });

        const startAnalysisBtn = document.getElementById('start-analysis-btn');
        startAnalysisBtn.addEventListener('click', () => {
            startAnalysisBtn.parentElement.style.display = 'none';
            document.getElementById('analysis-processing-indicator').style.display = 'block';

            setTimeout(() => {
                document.getElementById('analysis-processing-indicator').style.display = 'none';
                document.getElementById('analysis-results-wrapper').style.display = 'block';
                
                const candidatePoints = findCandidateSites();
                displayCandidateSites(candidatePoints);
                highlightCandidateRegion();
                
            }, 1500);
        });

        function highlightCandidateRegion() {
            if (candidateRegionHighlightLayer) {
                map.removeLayer(candidateRegionHighlightLayer);
            }
            if (regionGeojsonData) {
                const regionName = "Amhara";
                const regionFeature = regionGeojsonData.features.find(
                    feature => feature.properties.NAME_1 === regionName
                );

                if (regionFeature) {
                    candidateRegionHighlightLayer = L.geoJSON(regionFeature, {
                        style: {
                            color: "#ff0000",
                            weight: 2,
                            opacity: 1,
                            fillColor: "#ff0000",
                            fillOpacity: 0.3
                        }
                    }).addTo(map);
                }
            }
        }

        function findCandidateSites() {
            // 하드코딩된 후보지를 반환합니다.
            return [
                { lat: 5.905696, lon: 38.650472 },
                { lat: 10.819452, lon: 36.647936 },
                { lat: 8.204129, lon: 39.125290 },
                { lat: 7.49, lon: 38.53 }
            ];
        }

        function displayCandidateSites(sites) {
            candidateSiteLayerGroup.clearLayers();
            
            const listElement = document.getElementById('candidate-sites-list');
            const countElement = document.getElementById('candidate-sites-count');
            const legendCountElement = document.getElementById('candidate-sites-count-legend');
            
            listElement.innerHTML = '';
            
            if (!sites || sites.length === 0) {
                countElement.textContent = '0';
                legendCountElement.textContent = '0';
                listElement.innerHTML = '<p class="text-gray-500 text-sm">No candidate sites found.</p>';
                return;
            }

            const markers = [];

            sites.forEach((site, index) => {
                const siteNumber = index + 1;
                const lat = parseFloat(site.lat);
                const lon = parseFloat(site.lon);

                const marker = L.marker([lat, lon], {
                    icon: createNumberedIcon(siteNumber)
                }).bindPopup(`<b>후보지 #${siteNumber}</b><br>위도: ${lat.toFixed(4)}, 경도: ${lon.toFixed(4)}`);

                markers.push(marker);

                const listItem = document.createElement('div');
                listItem.className = 'flex items-center justify-between p-2 rounded-lg hover:bg-blue-50 transition-colors';
                listItem.innerHTML = `
                    <div class="flex items-center gap-3 flex-grow cursor-pointer">
                        <span class="flex-shrink-0 flex items-center justify-center w-6 h-6 bg-red-500 text-white font-bold rounded-full text-sm">${siteNumber}</span>
                        <div class="text-sm">
                            <span class="font-medium text-gray-800">위도: ${lat.toFixed(2)}</span>, 
                            <span class="font-medium text-gray-800">경도: ${lon.toFixed(2)}</span>
                        </div>
                    </div>
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer" data-site-number="${siteNumber}" data-lat="${lat}" data-lon="${lon}">
                `;
                
                listItem.addEventListener('click', (e) => {
                    // 체크박스 클릭 시에는 지도 이동 방지
                    if (e.target.type !== 'checkbox') {
                        map.flyTo([lat, lon], 12);
                        marker.openPopup();
                    }
                });

                listElement.appendChild(listItem);
            });

            markers.forEach(marker => {
                candidateSiteLayerGroup.addLayer(marker);
            });
            
            countElement.textContent = sites.length;
            legendCountElement.textContent = sites.length;
        }

        // --- Report Generation Logic ---
        const reportBtn = document.getElementById('generate-report-btn');
        const resultsList = document.getElementById('candidate-sites-list');
        const reportContainer = document.getElementById('report-container');
        const reportContentEl = document.getElementById('report-content');

        function updateReportButtonState() {
            const checkedCheckboxes = resultsList.querySelectorAll('input[type="checkbox"]:checked');
            if (checkedCheckboxes.length > 0) {
                reportBtn.disabled = false;
                reportBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                reportBtn.disabled = true;
                reportBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        resultsList.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                updateReportButtonState();
            }
        });

        reportBtn.addEventListener('click', () => {
            const selectedSites = [];
            const checkedCheckboxes = resultsList.querySelectorAll('input[type="checkbox"]:checked');
            
            checkedCheckboxes.forEach(checkbox => {
                selectedSites.push({
                    site: checkbox.dataset.siteNumber,
                    lat: checkbox.dataset.lat,
                    lon: checkbox.dataset.lon
                });
            });

            if (selectedSites.length > 0) {
                generateReport();
            } else {
                alert('Please select at least one site to generate a report.');
            }
        });

        function generateReport() {
            reportContainer.classList.remove('hidden');
            
            const fullReportText = `
                <h3 class="text-xl font-bold mb-4">우물 후보 4 개 지점 선정·분석 종합 리포트</h3>
                <p class="text-sm text-gray-500 mb-6">(Hambela Wamena, Ankasha, Dodota, Shala)</p>

                <h4 class="font-bold mt-6 mb-2">1. 평가 프레임워크 요약</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">단계</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">설명</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">반영 비율</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr>
                                <td class="px-4 py-4">① 적격 필터</td>
                                <td class="px-4 py-4">
                                    <ul class="list-disc list-inside">
                                        <li>기존 우물 반경 10 km 외</li>
                                        <li>지하수 등급 ≥ I-M/H (또는 ‘Very High’)</li>
                                        <li>토지 이용: 경작·정착지 값 0</li>
                                        <li>가뭄지수 ≤ 1.0 (극심) 또는 ≥ 9.0 (저긴급)</li>
                                    </ul>
                                </td>
                                <td class="px-4 py-4">―</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">② 정량 점수</td>
                                <td class="px-4 py-4">인구 30 % · 지하수 30 % · 가뭄 20 % · 토지 20 % (0–1 척도)</td>
                                <td class="px-4 py-4">100 %</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">③ 품질 검증</td>
                                <td class="px-4 py-4">시추 성공률·수질, 태양광 면적, 접근성 등 기술·재무 실현성</td>
                                <td class="px-4 py-4">보완 지표</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">④ 분쟁 리스크</td>
                                <td class="px-4 py-4">초국가 수량 갈등, 지역·민족 갈등, 환경 규제 위험</td>
                                <td class="px-4 py-4">서술 평가</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="font-bold mt-6 mb-2">2. 후보지별 상세 분석</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">#</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">좌표 / 행정구역</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">선정 핵심 이유</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">잠재 분쟁·환경 리스크</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr>
                                <td class="px-4 py-4">1</td>
                                <td class="px-4 py-4">5.91 °N, 38.65 °E<br>Hambela Wamena (Guji 존)</td>
                                <td class="px-4 py-4">
                                    <ul class="list-disc list-inside">
                                        <li>인구 296 명 km⁻²</li>
                                        <li>기존 우물 54.5 km</li>
                                        <li>Genale-Dawa 현무암층, I-M/H 등급 → 1–5 L s⁻¹ 예상 <br><small>scirp.org, etd.aau.edu.et</small></li>
                                        <li>지속 가뭄·사료 부족 지역</li>
                                    </ul>
                                </td>
                                <td class="px-4 py-4"><strong>중간</strong> – Genale-Dawa 수계가 케냐·소말리아로 이어져 장래 관개 확장 시 수량 배분 협상 필요. 지역 목축민 간 우물 소유권 분쟁 사례도 있음 <br><small>earthisland.org</small></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">2</td>
                                <td class="px-4 py-4">10.82 °N, 36.65 °E<br>Ankasha (Awi 존)</td>
                                <td class="px-4 py-4">
                                    <ul class="list-disc list-inside">
                                        <li>인구 230 명 km⁻²</li>
                                        <li>Blue Nile 상류, I-M/H 지질 <br><small>sciencedirect.com</small></li>
                                        <li>가뭄지수 0.0 → 최우선 수요</li>
                                    </ul>
                                </td>
                                <td class="px-4 py-4"><strong>높음</strong> – Blue Nile 수계 신규 양수는 이집트·수단과 긴장 지속. GERD 운영·충수 시기와 연동된 외교 민감 지역 <br><small>apnews.com, carnegieendowment.org, sciencedirect.com</small></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">3</td>
                                <td class="px-4 py-4">8.20 °N, 39.13 °E<br>Dodota (Arsi 존)</td>
                                <td class="px-4 py-4">
                                    <ul class="list-disc list-inside">
                                        <li>인구 212 명 km⁻²</li>
                                        <li>기존 우물 22.6 km</li>
                                        <li>리프트계곡 현무암, I-M/H</li>
                                        <li>식수·축수 겸용 잠재</li>
                                    </ul>
                                </td>
                                <td class="px-4 py-4"><strong>낮음(외교)</strong> – 폐쇄 내륙 유역<br><strong>주의(건강)</strong> – 고불소·염분 잠재, 필터 비용 반영 필요 <br><small>researchgate.net, pmc.ncbi.nlm.nih.gov</small></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">4</td>
                                <td class="px-4 py-4">7.49 °N, 38.53 °E<br>Shala (West Arsi 존)</td>
                                <td class="px-4 py-4">
                                    <ul class="list-disc list-inside">
                                        <li>인구 283 명 km⁻²</li>
                                        <li>Very High 지하수 등급, 18 km 이상 기존 우물</li>
                                        <li>반복 가뭄 및 IPC 2-3 단계 <br><small>sciencedirect.com, amazon.com</small></li>
                                    </ul>
                                </td>
                                <td class="px-4 py-4"><strong>매우 낮음(외교)</strong> – 폐쇄호수 유역<br><strong>보통(지역)</strong> – 목축 이동경로 중첩, 이용 규정·관리위 설치 필요 <br><small>ejol.aau.edu.et</small></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="font-bold mt-6 mb-2">3. 왜 이 네 곳인가?</h4>
                <h5 class="font-semibold mt-4 mb-1">사회·경제 편익 극대화</h5>
                <p>평균 인구 255 명 km⁻², 기존 우물 네트워크와 18 – 55 km 떨어져 ‘중복 투자’ 위험이 없음.</p>
                <h5 class="font-semibold mt-4 mb-1">지하수 성공 가능성</h5>
                <p>네 곳 모두 균열 현무암대(I-M/H) 또는 Very High 등급으로, 시추 성공률 ≥ 80 % 예측.</p>
                <h5 class="font-semibold mt-4 mb-1">가뭄·식수 긴급도</h5>
                <p>Hambela·Ankasha·Dodota·Shala 모두 가뭄지수 0.0 또는 IPC 2-3 수준의 물 스트레스 지역.</p>
                <h5 class="font-semibold mt-4 mb-1">토지 갈등 최소화</h5>
                <p>Geo-Wiki 값 0 → 경작·정착지 없는 공동 목초지/초지·공원 완충대; 사유지 보상 부담 ↓.</p>

                <h4 class="font-bold mt-6 mb-2">4. 분쟁 · 위협 통합 평가</h4>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">유형</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">위치</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">리스크 요약</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">대응 권고</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr>
                                <td class="px-4 py-4">초국가 수계 갈등</td>
                                <td class="px-4 py-4">Ankasha (Blue Nile)</td>
                                <td class="px-4 py-4">GERD 이후 이집트·수단의 “상류 신규 개발 감시” 대상.</td>
                                <td class="px-4 py-4">NBI, AU-WRG 등 국제 투명성 플랫폼에 수위·양수 데이터 실시간 공개.</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">연계 수계 협상</td>
                                <td class="px-4 py-4">Hambela Wamena</td>
                                <td class="px-4 py-4">Genale-Dawa 하류(소말리아·케냐) 관개 확장 시 물 배분 협상 필요.</td>
                                <td class="px-4 py-4">IGAD 수자원 작업반에 프로젝트 등록, 삼국 MOU 추진.</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">지역 목축·민족 분쟁</td>
                                <td class="px-4 py-4">Hambela·Shala</td>
                                <td class="px-4 py-4">보레홀 소유권·접근 통제로 무력 충돌 사례.</td>
                                <td class="px-4 py-4">우물 관리위원회 구성, 전통 의사결정(Gadaa) 절차 포함.</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4">수질·보건 위험</td>
                                <td class="px-4 py-4">Dodota</td>
                                <td class="px-4 py-4">불소·염분 농도↑ → 치아·골격 플루오린증 우려.</td>
                                <td class="px-4 py-4">역삼투·활성알루미나 필터 예산( CapEx + OpEx ≒ 0.5 US¢ L⁻¹) 포함.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="font-bold mt-6 mb-2">5. 종합 권고</h4>
                <h5 class="font-semibold mt-4 mb-1">착수 우선순위</h5>
                <p>Ankasha ↔ Hambela Wamena (긴급도·편익 동등) → 병행 타당성 조사, Dodota·Shala는 2차 단계.</p>
                <h5 class="font-semibold mt-4 mb-1">외교·데이터 투명성</h5>
                <p>Ankasha 프로젝트는 Nile Basin Initiative 포털에 양수·수위 실시간 송신.</p>
                <h5 class="font-semibold mt-4 mb-1">지역 참여</h5>
                <p>두 목축 지역(Hambela, Shala)은 커뮤니티 우물 관리위원회 + 전통 엘더 자문 의무화.</p>
                <h5 class="font-semibold mt-4 mb-1">수질 관리</h5>
                <p>Dodota는 불소 제거 필터 예산 반영, 연 1회 수질 모니터링.</p>
                <h5 class="font-semibold mt-4 mb-1">장기 모니터링</h5>
                <p>4 개소 모두 IoT 유량·수위 센서 + 위성 통신 설치, 공개 대시보드로 투명성 확보.</p>

                <p class="mt-6">이 네 지점은 최대 사회편익과 최소 외교·지역 갈등을 동시에 달성하도록 설계되었습니다. 단계별 타당성 조사(EIA·수질·시추 테스트) 후 착공을 권장합니다.</p>
            `;

            const progressSteps = [
                { percent: 0, text: "Initializing analysis..." },
                { percent: 25, text: "Gathering geological data..." },
                { percent: 50, text: "Analyzing population density..." },
                { percent: 75, text: "Assessing conflict & environmental risk..." },
                { percent: 100, text: "Compiling final report..." }
            ];

            reportContentEl.innerHTML = `
                <div id="report-progress-container" class="py-8">
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
                        <div id="report-progress-bar" class="bg-blue-600 h-4 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
                    </div>
                    <p id="report-progress-text" class="text-center text-gray-600 font-semibold"></p>
                </div>
            `;

            const progressBar = document.getElementById('report-progress-bar');
            const progressText = document.getElementById('report-progress-text');
            let currentStep = 0;

            function updateProgress() {
                if (currentStep < progressSteps.length) {
                    const step = progressSteps[currentStep];
                    progressBar.style.width = step.percent + '%';
                    progressText.textContent = step.text;
                    currentStep++;
                    setTimeout(updateProgress, 1200);
                } else {
                    reportContentEl.innerHTML = fullReportText;
                    scrollToReport();
                }
            }
            updateProgress();
        }

        function scrollToReport() {
            reportContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
</script>
</body>
</html> 